#!/usr/bin/env bash

# enable pattern lists like +(...|...)
shopt -s extglob

# The master and develop branches are continuously deployed to production and staging.
# You can also add additional branches here which will be deployed to a temporary staging site.
# Separate branches with a | character. e.g. "+(branch1|branch2)"
readonly DEPLOY_BRANCHES="+(web-updates)"

# The git branch we are on
readonly GITBRANCH="$(git symbolic-ref --short -q HEAD)"

# The appname used if we deploy with 'cf push appname'
# (not used for master and develop, which use manifests instead)
readonly CF_PUSH_APPNAME="pr-`basename ${CI_PULL_REQUEST}`-${CIRCLE_PROJECT_REPONAME}"

# Use the branch name to set jekyll config:
# - DTA_SITE_BASEURL - used in jekyll for site.baseurl
# - DTA_SITE_URL - used in jekyll for site.url
export DTA_SITE_BASEURL=""
case "${GITBRANCH}" in
  master)
    export DTA_SITE_URL="https://www.dta.gov.au"
    ;;
  develop)
    export DTA_SITE_URL="https://dta.apps.staging.digital.gov.au"
    ;;
  *)
    export DTA_SITE_URL="https://${CF_PUSH_APPNAME}.apps.staging.digital.gov.au"
    ;;
esac

# use /tmp if TMPDIR is not defined
if [[ -z "$TMPDIR" ]]
then
    export TMPDIR="/tmp"
fi
