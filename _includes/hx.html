{% comment %}
This include can be instead of a heading, and will generate a heading that can be linked to, as well as an
optional "Back to top" link

Parameters:
- lvl = The heading level to create e.g. 1
- text = The heading text
- hide-back-to-top - (Optional) If set, the Back to top link is not inserted

example usage:
{% include hx.html lvl=2 text="This is my heading" hide-back-to-top=1 %}

{% endcomment %}

{% comment %}

FIRST ATTEMPT
The id is different to that generated by markdown
{% endcomment %}
{% comment %}

{% unless include.hide-back-to-top %}
<div class="back-to-top-link">
  <a href="#content">Back to top &uarr;</a>
</div>
{% endunless %}
<h{{ include.lvl }} id="{{ include.text | slugify }}"><a href="#{{ include.text | slugify }}" class="headline-slug-link">{{ include.text }}</a></h{{ include.lvl }}>

{% endcomment %}

{% comment %}

SECOND ATTEMPT
The only apparent way to get the correct id of the heading is using markdownify:
1. Generate the heading as a markdown string e.g "## My heading"
2. Convert it to html using markdownify
3. Extract the id
{% endcomment %}

{% capture hashes %}{% for i in (1..include.lvl) %}#{% endfor %}{% endcapture %}
{% assign heading_md = hashes | append: ' ' | append: include.text %}
{% assign heading_html = heading_md | markdownify %}
{% assign heading_split = heading_html | split: '"' %}
{% assign heading_id = heading_split[1] %}

{% unless include.hide-back-to-top %}
<div class="back-to-top-link">
  <a href="#content">Back to top &uarr;</a>
</div>
{% endunless %}
<h{{ include.lvl }} id="{{ heading_id }}"><a href="#{{ heading_id }}" class="headline-slug-link">{{ include.text }}</a></h{{ include.lvl }}>

{% comment %}{{ heading_md | markdownify }}{% endcomment %}
