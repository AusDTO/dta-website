---
machine:
  ruby:
    version: 2.3.1
  environment:
    ACCESSLINT_MASTER_BRANCH: develop # the branch that PRs are being made to

    # Go to https://accesslint.com and get an Accesslint API token.
    # Add ACCESSLINT_API_TOKEN and ACCESSLINT_GITHUB_USER env vars to circle for this repo.

general:
  artifacts:
    - "_site"
    - "tmp"

dependencies:
  pre:
    - gem install bundler
    - bundle install
  override:
    - npm install -g accesslint-cli
    - gem install accesslint-ci

dependencies:
  override:
    - bin/ciprepare.sh

test:
  override:
    - bin/cibuild.sh
    - bin/ciserve.sh:
        background: true
    - bin/citest.sh
deployment:
  all:
    branch: /.*/
    commands:
      - bin/cideploy.sh
